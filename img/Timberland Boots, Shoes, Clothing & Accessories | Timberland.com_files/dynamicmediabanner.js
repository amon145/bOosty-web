define(["jquery","pubsub","jquery-mobile-events","cycle","cms.videoplayer","base64"],function(a,b){!function(a,b,c,d){var e="dynamicMediaBanner",f=function(b,c){this.element=b,this.options=c,this.defaults={slides:"> .slide",pauseOnHover:!0,fx:"scrollHorz",autoHeight:"calc",prev:a(this.element).find(".cycle-prev"),next:a(this.element).find(".cycle-next"),pager:a(this.element).find(".cycle-pager"),pagerTemplate:"",swipe:!0,maxZ:50,adaptiveSlides:{small:[0,1,2,3,4],medium:[0,1,2,3,4],large:[0,1,2,3,4],xlarge:[0,1,2,3,4]},progressiveFeatureSlides:[],progressiveSupportSlides:[]},this.metadata=a(this.element).data("dynamicmediabanner-options")};f.prototype={defaults:{},init:function(){console.log("Initializing Dynamic Media Banner for",a(this.element));var c=this;if(c.config=a.extend({},c.defaults,c.options,c.metadata),c._build(),c.featureCarousel=a(c.element).find(".dmb-feature .carousel"),c.supportCarousel=a(c.element).find(".dmb-support .carousel"),c._initImageMaps(),c.featureCarousel.length<=0)return c._initSingleSlide();c.events(),c.filterSlides(),c.getAjaxSlides();var d=setInterval(function(){var a=c.config.progressiveFeatureSlides.concat(c.config.progressiveSupportSlides);a.length>0&&a.indexOf("loading")<0&&(clearInterval(d),c._initCarousels())},50),e=a(c.element).data("video-ratioW"),f=(a(c.element).data("video-ratioH"),e/666);return a(c.element).find(".slide.video").each(function(b,c){var d=a(c);console.log("resize video",a(c),f),d.height(d.width()/f)}),a(b).resize(function(){a(c.element).find(".slide.video").each(function(b,c){var d=a(c);d.height(d.width()/f)})}),c},events:function(){var b=this;b.featureCarousel.on("cycle-update-view",function(b,c){var d=a(".cycle-sentinel",b.target);d.find(".video").length&&d.find(".flex-video").empty()}),b.featureCarousel.on("cycle-initialized",function(b,c){a.pubsub("publish","vfdp.aem.dynamicmediabanner.initialized",{event:b,opts:c})}),b.featureCarousel.on("cycle-slide-added",function(b,c,d,e){a.pubsub("publish","vfdp.aem.dynamicmediabanner.slideAdded",{event:b,opts:c,slideOpts:d,slide:e})}),b.featureCarousel.on("cycle-before",function(b,c){a.pubsub("publish","vfdp.aem.dynamicmediabanner.slideBefore",{event:b,opts:c})}),b.featureCarousel.on("cycle-after",function(b,c){a.pubsub("publish","vfdp.aem.dynamicmediabanner.slideAfter",{event:b,opts:c})}),b.featureCarousel.on("cycle-next",function(b,c){a.pubsub("publish","vfdp.aem.dynamicmediabanner.next",{event:b,opts:c})}),b.featureCarousel.on("cycle-prev",function(b,c){a.pubsub("publish","vfdp.aem.dynamicmediabanner.prev",{event:b,opts:c})}),b.featureCarousel.on("cycle-paused",function(b,c){a.pubsub("publish","vfdp.aem.dynamicmediabanner.paused",{event:b,opts:c})}),b.featureCarousel.on("cycle-resumed",function(b,c){a.pubsub("publish","vfdp.aem.dynamicmediabanner.resumed",{event:b,opts:c})})},_initSingleSlide:function(){var a=this;return a.loadVideos(),a},_initImageMaps:function(){var c=this;return c.updateImageMaps(),a(b).resize(function(){c.updateImageMaps()}),c},_initCarousels:function(){var a=this;a.supportCarousel.size()>0&&a._initSupportCarousel(),a._initFeatureCarousel()},_initFeatureCarousel:function(){var c=this;return a(c.element).on("click",function(a,b){c.featureCarousel.cycle("pause")}),c.featureCarousel.one("cycle-bootstrap",function(){a(c.featureCarousel).height(a("div:first-child",c.featureCarousel).outerHeight())}),c.featureCarousel.one("cycle-post-initialize",function(){setTimeout(function(){a(c.featureCarousel).height("auto")},50)}),c.featureCarousel.on("cycle-initialized",function(a,b){c.loadVideos()}),c.featureCarousel.on("cycle-before",function(a,b){c.pauseVideos()}),c.featureCarousel.on("cycle-slide-added",function(){b.picturefill(),main.update(),c.loadVideos(),c.updateImageMaps(),c.enableNextIndicator()}),c.config=a.extend({},c.config,{slideCount:c.config.progressiveFeatureSlides.length+1,progressive:c.config.progressiveFeatureSlides}),c._initIndicators(),c.featureCarousel.cycle(c.config),c},_initSupportCarousel:function(){var b=this;b.supportCarousel.on("cycle-slide-added",function(){main.update()}),b.supportCarousel.one("cycle-bootstrap",function(){a(b.supportCarousel).height(a("div:first-child",b.supportCarousel).outerHeight())}),b.supportCarousel.one("cycle-post-initialize",function(){setTimeout(function(){a(b.supportCarousel).height("auto")},50)});var c=a.extend({},b.config,{paused:"true",prev:!1,next:!1,pager:!1,pauseOnHover:!1,swipe:!1,progressive:b.config.progressiveSupportSlides});return b.supportCarousel.cycle(c),b.featureCarousel.on("cycle-before",function(a,c,d,e,f){f?0===c.nextSlide||c.nextSlide==c.currSlide+1?b.supportCarousel.cycle("next"):b.supportCarousel.cycle(c.nextSlide):c.nextSlide==c.slideCount-1||c.nextSlide==c.currSlide-1?b.supportCarousel.cycle("prev"):b.supportCarousel.cycle(c.nextSlide)}),b},_initIndicators:function(){var b=this,c=a(b.element).find(".cycle-pager");c.html("");for(var d=0;d<b.config.slideCount;d++)c.append('<span class="disabled">&nbsp;</span>')},addIndicator:function(){var b=this,c=a(b.element).find(".cycle-pager");c.append('<span class="disabled">&nbsp;</span>')},enableNextIndicator:function(){var b=this,c=a(a(b.element).find(".cycle-pager .disabled").get(0));c.removeClass("disabled")},_build:function(){},getAjaxSlides:function(){function b(b,e){b.forEach(function(b,f){e[f]="loading",d.push(a.ajax({url:b,dataType:"html",context:c}).done(function(b){e[f]=a(b)}).fail(function(){console.warn("slide failed to load",b)}))})}var c=this,d=[];b(c.config.featureSlides,c.config.progressiveFeatureSlides),b(c.config.supportSlides,c.config.progressiveSupportSlides),a.when.apply(c,d).done(function(){console.log("slides retrieved")}).fail(function(){console.error("failed to retrieve slides")})},filterSlides:function(){var a=this;a.config.featureSlides=a.config.featureSlides.filter(function(a,b){return a&&this._filterSlide(b)},a),a.config.supportSlides=a.config.supportSlides.filter(function(a,b){return a&&this._filterSlide(b)},a)},_filterSlide:function(a){var b=this;return a+=1,"undefined"==typeof this.currentSize&&(this.currentSize=main.screen.size()),b.config.adaptiveSlides[this.currentSize].indexOf(a)>=0?!0:!1},updateImageMaps:function(){var b=this;a(b.element).find(".image-maps").each(function(b){if(a(this).children().size()>0){var c=a(this).prev().find("picture > img"),d="."+main.screen.size()+"-map",e=a(this).children(d);if(e.size()<1&&(d=".large-map",e=a(this).children(d)),e.size()>0&&c.size()>0){var f=e.children("map"),g=e.attr("data-image-size").split(","),h=e.children("map").attr("id");c.attr("usemap","#"+h),1==f.size()&&(f.clone().attr("id",f.attr("id")+"c").attr("name","clonenomap").insertAfter(f),f=e.children("map"));var i,j=f[0].getElementsByTagName("area"),k=f[1].getElementsByTagName("area"),l=j.length,m=[],n=g[0];for(i=0;l>i;i++)m[i]=k[i].coords.split(",");var o,p,q=c[0].offsetWidth/n;for(i=0;l>i;i++){for(p=m[i].length,o=0;p>o;o++)m[i][o]*=q;j[i].coords=m[i].join(",")}}}})},pauseVideos:function(){var b=a(this.element).find("[data-videoplayer-videoid]");b.length>0&&b.data("videoPlayer")!==d&&null!==b.data("videoPlayer")},loadVideos:function(){var b=this,c=a(b.element).find("[data-videoplayer-videoid]");c.length>0&&(a(c).on("video-play",function(a){b.featureCarousel.cycle("pause")}),c.videoPlayer())}},f.defaults=f.prototype.defaults,a.fn.dynamicMediaBanner=function(b){return this.each(function(){var c=a(this).data(e);c||(c=new f(this,b).init(),a(this).data(e,c))})}}(jQuery,window,document)});
//# sourceMappingURL=dynamicmediabanner.js.map