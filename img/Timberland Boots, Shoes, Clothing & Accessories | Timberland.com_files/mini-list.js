define(["jquery","wcs.context","wcs.global-events","wcs.alert","wcs.free-gift","pubsub"],function(a,b,c,d,e){function f(b,c,e,f){"top"===q&e.isInit===!1?d.showLoadingNotification("p"):"right"===q&&d.showLoadingNotificationByPosition("l",".global-cart-wishlist-panels-js");r.find(".cart-item-container-js");a.ajax({url:b,dataType:"html",data:c,success:function(a){}}).done(function(a){"top"===q?i(a,e,f):i(a,e)}).always(function(a){"top"===q&e.isInit===!1?d.hideLoadingNotification():"right"===q&&d.hideLoadingNotificationByPosition(".global-cart-wishlist-panels-js")})}function g(){a(".global-cart-wishlist-panels-js").on({click:function(b){var c=a(b.target),d=null;if("close"===c.data("action"))"top"===WCS_CONFIG.get("global::miniCartLocation")?a(".unav-shoppingbag-js").trigger("click"):(a(".global-cart-wishlist-panels-js .tags .active").trigger("click"),d=a(".global-cart-wishlist-panels-js .content .cart-list"),a.each(d,function(){a(this).html("")}));else if("delete"===c.data("action")||"add to cart"===c.data("action")){b.preventDefault();var e=c.parents(".cart-list"),f={title:e.find(".page-title").text(),page:e.data("tabcontent"),container:e},g="add to cart"===c.data("action")?LANG_MSG["DEFAULT_MINICART.MSG.movedToShoppingCart"]:void 0;if(h(c.attr("href"),f,g,c.data("action")),"add to cart"===c.data("action")){var i=c.parents(".cart-item-js").find(".cart-item-row"),j="";i.find(".item-attr-js.defining").each(function(){j+=(j.length>0?" / ":"")+a(this).text()});var k=i.find(".product-info-js").data("seo-category"),l=!1,m=l?$$.get(".product-listing-js").data("category-identifier"):"",n=i.find(".product-info-js").data("bundle-partNumber"),o=i.find(".product-info-js").data("item-partnumber"),p=i.find(".product-info-js").data("master-category"),q=i.find(".product-info-js").data("parent-product-id"),r=i.find(".product-info-js").data("child-product-id"),s=i.find(".product-info-js").data("part-number"),t=i.find(".item-price-js").data("unit-price"),u={currency:a(".global-cart-wishlist-panels-js").data("currency"),productName:i.find(".item-name-js").text().replace(/^\s+|\s+$/gm,""),productId:s?s:"",unitPrice:t?t:"",definingAttributes:a.trim(j),quantity:i.find(".item-qty-js").data("qty"),categoryId:m?m:"",masterCategoryId:p?p:"",childPartNumber:o?o:"",parentProductId:q?q:"",childProductId:r?r:"",bundlePartNumber:n?n:"",seoCategory:k?k:"",isQuickView:l,isSearch:l&&"search"===m};console.debug(u),zm.trackAddedItem(u)}}}})}function h(f,g,h,j){j=j||"remove","top"===q&&d.showLoadingNotification("p"),a.ajax({url:f,type:"POST",dataType:"html",success:function(d){var f=!1;if(("shopcart"===g.page||"add to cart"===j)&&(a(".shopcart-js").length>0&&"add to cart"===j&&"wishlist"===g.page?(f=!0,window.location.href=a(".btn-shoppingbag-js").attr("href")):a.pubsub("publish",c.SHOPCART_UPDATED,j)),!f&&("wishlist"===g.page&&a.pubsub("publish",c.WISHLIST_UPDATED,j),i(d,g,h,j),"wishlist"===g.page&&"add to cart"===j&&"undefined"!=typeof orderId)){var k="";if(void 0!=b.getCookie("allowFreeGifts_"+orderId)&&(k=b.getCookie("allowFreeGifts_"+orderId)),"undefined"!=typeof isMiniWishList&&"undefined"!=typeof rewardOptionEligible&&"true"===rewardOptionEligible&&""===k){var l=a(".free_gifts_block a").attr("href");a(".free_gifts_block a").attr("href",l+"&orderId="+orderId),a(".wishlist-js").trigger("click"),a(".free_gifts_block a").trigger("click"),a("#freeGiftModal").on("opened.fndtn.reveal",function(){e.init(a(this))})}}}}).always(function(a){"top"===q&&d.hideLoadingNotification()})}function i(d,e,f,g){e.container.html(d),"add to cart"===g&&e.container.find(".ajax-messaging").html('<p class="message success">'+f+"</p>");try{if("undefined"!=typeof orderId){var h="";void 0!=b.getCookie("allowFreeGifts_"+orderId)&&(h=b.getCookie("allowFreeGifts_"+orderId)),"undefined"!=typeof isMiniCart&&"undefined"!=typeof rewardOptionEligible&&"false"==rewardOptionEligible&&""!==h&&b.removeCookie("allowFreeGifts_"+orderId)}}catch(i){}finally{r.find(".close-btn").on("click",function(){r.find(".tags .active").click()}),l(e),a.pubsub("publish",c.MINICART_CONTENT_RENDER_COMPLETE,f)}}function j(b){var c=b.container.height(),d=0,e=b.container.find(".content-head"),f=parseInt(e.css("margin-top"),10),g=parseInt(e.css("margin-bottom"),10),h=e.find(".section-title"),i=parseInt(h.css("margin-top"),10),j=h.outerHeight(!1),k=e.find(".page-title"),l=parseInt(k.css("margin-top"),10),m=k.outerHeight(!1),n=b.container.find(".cart-actions, .wishlist-actions").outerHeight(!0),o=0,p=0,q=0,r=b.container.find(".waved-line-sep"),s=parseInt(r.css("margin-top"),10),t=r.outerHeight(!0),u=Math.max(f,i);d=u+j+l+m+g,d=Math.max(u+g,d);var v=b.container.find(".free-shipping-promo"),w=b.container.find(".mini-cart-promo-header");return v.length>0?(o=parseInt(v.css("margin-top"),10),p=v.outerHeight(!1),q=parseInt(v.css("margin-bottom"),10)):w.length>0&&w.each(function(){var b=a(this);return b.parents(".cart-item-container-js").length>0?!1:(o=parseInt(b.css("margin-top"),10),p=parseInt(b.parents(".espot-container").outerHeight(!1)),q=parseInt(b.parents(".espot-container").find("p").css("margin-bottom"),10),void 0)}),p=o+p+q,c-d-n-t-p+Math.min(q,s)}function k(a){var b=a.container.find(".cart-item-slide-js").outerHeight(!0),c=j(a);if("top"===WCS_CONFIG.get("global::miniCartLocation")){var d=a.container.find(".cart-item-js").length,b=a.container.find(".cart-item-js").outerHeight(!0);c=b*Math.min(2,d),a.container.find(".cart-item-container-js").css("height",c+"px"),d>2?a.container.find(".cart-item-nav").hasClass("hide")&&a.container.find(".cart-item-nav").removeClass("hide"):a.container.find(".cart-item-nav").hasClass("hide")||(a.container.find(".cart-item-nav").addClass("hide"),a.container.find(".cart-item-slide-js").css("top",""))}else c>=b?(a.container.find(".cart-item-container-js").css("height",c+"px"),a.container.find(".cart-item-nav").hasClass("hide")||(a.container.find(".cart-item-nav").addClass("hide"),a.container.find(".cart-item-slide-js").css("top",""))):(a.container.find(".cart-item-container-js").css("height",c-70+"px"),a.container.find(".cart-item-nav").hasClass("hide")&&a.container.find(".cart-item-nav").removeClass("hide"))}function l(b){function c(a){var b=a.css("top");return"auto"==b&&(b="0px"),parseFloat(b.replace(/[^-\d\.]/g,""))}function d(c){var d=a(c.target);if(d.hasClass("cart-item-container-js")||d.parents(".cart-item-container-js").length>0){if("undefined"!=typeof window.event&&null!=window.event&&window.event.wheelDelta)var e=window.event.wheelDelta;else var e=-c.originalEvent.deltaY;var f=Math.max(-1,Math.min(1,e));return 0>f?b.container.find(".cart-item-nav.next").hasClass("hide")||b.container.find(".cart-item-nav.next").hasClass("disabled")||b.container.find(".cart-item-nav.next").trigger("click"):f>0&&(b.container.find(".cart-item-nav.prev").hasClass("hide")||b.container.find(".cart-item-nav.prev").hasClass("disabled")||b.container.find(".cart-item-nav.prev").trigger("click")),!1}return!0}k(b),b.container.find(".cart-item-nav.prev").on("click",function(){if(!a(this).hasClass("ready"))return!1;if(a(this).hasClass("disabled"))return!1;var b=c(a(this).closest(".cart-list").find(".cart-item-slide-js")),d=a(this).closest(".cart-list").find(".cart-item").outerHeight(!0);a(this).removeClass("ready"),a(this).closest(".cart-list").find(".cart-item-nav.next").removeClass("disabled"),a(this).closest(".cart-list").find(".cart-item-slide-js").animate({top:"+="+Math.min(-b,d)},300,function(){a(this).closest(".cart-list").find(".cart-item-nav.prev").addClass("ready");var b=c(a(this).closest(".cart-list").find(".cart-item-slide-js"));b>=0&&a(this).closest(".cart-list").find(".cart-item-nav.prev").addClass("disabled")})}),b.container.find(".cart-item-nav.next").on("click",function(){if(!a(this).hasClass("ready"))return!1;var d=b.container.find(".cart-item-slide-js").outerHeight(!0),e=b.container.find(".cart-item-container-js").outerHeight(!0),f=c(a(this).closest(".cart-list").find(".cart-item-slide-js")),g=a(this).closest(".cart-list").find(".cart-item").outerHeight(!0);return d+parseInt(f)<=e?!1:(a(this).removeClass("ready"),a(this).closest(".cart-list").find(".cart-item-nav.prev").removeClass("disabled"),void a(this).closest(".cart-list").find(".cart-item-slide-js").animate({top:"-="+g},300,function(){a(this).closest(".cart-list").find(".cart-item-nav.next").addClass("ready");var d=b.container.find(".cart-item-slide-js").outerHeight(!0),e=b.container.find(".cart-item-container-js").outerHeight(!0),f=c(a(this).closest(".cart-list").find(".cart-item-slide-js"));d+parseInt(f)<=e&&a(this).closest(".cart-list").find(".cart-item-nav.next").addClass("disabled")}))}),b.container.find(".cart-item-container-js").on({wheel:d,touchstart:function(b){var d=a(this).closest(".cart-list").find(".cart-item-slide-js");d.stop(),m=!0,o=b.originalEvent.touches[0].clientY,p=c(d)},touchmove:function(c){n=!0,c.preventDefault();var d=a(this).closest(".cart-list").find(".cart-item-slide-js"),e=a(this).closest(".cart-list").find(".cart-item-container-js"),f=d.outerHeight(!0),g=e.outerHeight(!0),h=c.originalEvent.touches[0].clientY-o,i=p+h,j=Math.min(0,g-f),k=b.container.find(".cart-item-nav.prev"),l=b.container.find(".cart-item-nav.next");0>i&&i>j?(d.css("top",i+"px"),k.hasClass("disabled")&&k.removeClass("disabled"),l.hasClass("disabled")&&l.removeClass("disabled")):i>=0?(d.css("top",i/2+"px"),k.hasClass("disabled")||k.addClass("disabled")):j>=i&&(d.css("top",i/2+j/2+"px"),l.hasClass("disabled")||l.addClass("disabled"))},touchend:function(b){if(m&&n){var d=a(this).closest(".cart-list").find(".cart-item-slide-js"),e=a(this).closest(".cart-list").find(".cart-item-container-js"),f=d.outerHeight(!0),g=e.outerHeight(!0),h=g-f,i=c(d);i>0||g-f>0?d.animate({top:"0px"},400):g-f>i&&d.animate({top:h+"px"},400)}m=!1,n=!1,o=b.originalEvent.changedTouches[0].clientY}}),b.container.on({touchmove:function(a){a.preventDefault()}}),a(document).on("mousewheel",d),a(window).on("resize",function(){k(b);var a=b.container.find(".cart-item-slide-js").outerHeight(!0),d=j(b),e=c(b.container.find(".cart-item-slide-js"));a+parseInt(e)<d-50?b.container.find(".cart-item-nav.next").addClass("disabled"):b.container.find(".cart-item-nav.next").removeClass("disabled")})}var m=!1,n=!1,o=0,p=0,q=WCS_CONFIG.get("global::miniCartLocation"),r=a(".global-cart-wishlist-panels-js");return{renderMiniListItems:f,initMiniListActions:g,initCarousel:k}});
//# sourceMappingURL=mini-list.js.map