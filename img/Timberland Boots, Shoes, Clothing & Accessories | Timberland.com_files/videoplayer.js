define(["jquery"],function(a){!function(a,b,c,d){var e="videoPlayer",f=function(b,c){this.element=b,this.thumbnail=a(b).find(">.thumbnail"),this.videoWrapper=a(b).find(">.video"),this.playerId=a(b).data("videoplayer-playerid"),this.videoId=a(b).data("videoplayer-videoid"),this.options=c,this.supportedPlayers=["kaltura","youtube"],this.thumbOpen=!0,this.videoOpen=!1,this.metadata=a(this.element).data("videoplayer-options")};f.prototype={defaults:{},init:function(){var b=this;return console.log("initializing video player wrapper for",b.playerType,b.playerId,b.videoId),b.config=a.extend({},this.defaults,this.options,this.metadata),b.queue={content:null,push:function(a){this.content=a},pop:function(){this.content.call(),this.content=null}},main.ytplayers||(main.ytplayers=[]),main.kplayers||(main.kplayers=[]),b._build(),b._checkPlayerType(),b.load(),b._initThumbnail(),a(b.element).on("video-ready",function(){b.onPlayerReady()}),b},_checkPlayerType:function(){var b=this,c=a(b.element);if(b.playerType)return b.playerType;for(var d=0;d<b.supportedPlayers.length;d++)c.hasClass(b.supportedPlayers[d])&&(b.playerType=b.supportedPlayers[d]);return b.playerType},_attachPlayerAPI:function(){switch(console.log("attaching player API"),this._checkPlayerType(),this.playerType){case"youtube":break;case"kaltura":var b="#kaltura_player_"+this.playerId+"_"+this.videoId;this.player=a(this.element).find(b).get(0)}return this},_build:function(){},events:{youtube:{onPlayerReady:function(b){console.log("youtube player ready"),a(b.element).trigger("video-ready")},onPlayerStateChange:function(b,c){switch(console.log("youtube player state change",{playerinstance:b,state:c}),c.data){case-1:case 0:case 5:break;case 1:a(b.element).trigger("video-play");break;case 2:a(b.element).trigger("video-pause");break;case 3:a(b.element).trigger("video-buffering")}}},kaltura:{onPlayerStateChange:function(b,c){switch(console.log("kaltura player state change",{playerinstance:b,state:c}),c){case"uninitialized":case"loading":case"playbackError":break;case"ready":a(b.element).trigger("video-ready");break;case"playing":a(b.element).trigger("video-play");break;case"paused":a(b.element).trigger("video-pause");break;case"buffering":a(b.element).trigger("video-buffering")}}}},_initThumbnail:function(){var a=this;a.thumbnail.click(function(b){a.toggle("video",function(){a.play()})})},load:function(){var b=this;switch(this.playerType){case"youtube":b._youtubeAsyncLoadAPI();break;case"kaltura":a(b.element).on("kaltura-api-ready",function(){b._attachPlayerAPI()._kalturaOnAPIReady()}),b._kalturaAsyncLoadAPI()}},onPlayerReady:function(){var a=this;a.playerReady=!0,a.queue.content&&a.queue.pop()},play:function(){var a=this;a.playerReady?a._play():a.queue.push(function(){a._play()})},_play:function(){var a=this;switch(a.playerType){case"youtube":"undefined"==typeof b.orientation&&a.player.playVideo();break;case"kaltura":a.player.sendNotification("doPlay")}},pause:function(){var a=this;a.playerReady?a._pause():a.queue.push(function(){a._pause()})},_pause:function(){var a=this;switch(a.playerType){case"youtube":[YT.PlayerState.PLAYING,YT.PlayerState.BUFFERING].indexOf(this.player.getPlayerState())>=0&&this.player.pauseVideo();break;case"kaltura":this.player.sendNotification("doPause")}},toggle:function(a,b){console.log("displaying",a);var c=this;switch(a){case"video":c.hideThumb(function(){c.showVideo(b)});break;case"thumb":c.hideVideo(function(){c.showThumb(b)})}return c},showVideo:function(b){var c=this;a(c.videoWrapper).removeClass("hide").fadeIn(400,function(){c.videoOpen=!0,b&&b()})},hideVideo:function(b){var c=this;c.pause(),a(c.videoWrapper).fadeOut(400,function(){a(this).addClass("hide"),c.videoOpen=!1,b&&b()})},showThumb:function(b){var c=this;a(c.thumbnail).removeClass("hide").fadeIn(400,function(){c.thumbOpen=!0,b&&b()})},hideThumb:function(b){var c=this;a(c.thumbnail).fadeOut(400,function(){a(this).addClass("hide"),c.thumbOpen=!1,b&&b()})},_youtubeAsyncLoadAPI:function(){var d=this;if(0===a('[src="//www.youtube.com/player_api"]').length){console.log("Loading YouTube API");var e=c.createElement("script");e.src="//www.youtube.com/player_api";var f=c.getElementsByTagName("script")[0];f.parentNode.insertBefore(e,f)}b.youTubeAPIReady===!0?(console.log("youtube api already ready"),d._youtubeOnAPIReady(),d._attachPlayerAPI()):(a(b).on("youtube-api-ready",function(){b.youTubeAPIReady=!0,d._youtubeOnAPIReady(),d._attachPlayerAPI()}),"function"!=typeof b.onYouTubeIframeAPIReady&&(b.onYouTubeIframeAPIReady=function(){a(b).trigger("youtube-api-ready")}))},_youtubeOnAPIReady:function(){console.log("Creating youtube player");var b=this,c=this.element,d=a(c).find("[data-videoid]");if(a(d).attr("id")){var e={videoId:a(d).data("videoid"),height:a(d).data("height"),width:a(d).data("width"),playerVars:a(d).data("playervars"),events:{onReady:function(){b.events.youtube.onPlayerReady(b)},onStateChange:function(a){b.events.youtube.onPlayerStateChange(b,a)}}};b.player=new YT.Player(a(d).attr("id"),e)}},_kalturaAsyncLoadAPI:function(){var b=this,c=a(b.element).find(".flex-video.kaltura>div").data("kaltura-script"),d=a(b.element).find(".flex-video.kaltura>div").data("kaltura-wid"),e=a(b.element).find(".flex-video.kaltura>div").data("kaltura-uiconf-id"),f=a(b.element).find(".flex-video.kaltura>div").attr("id");require([c],function(c){kWidget.embed({targetId:f,wid:d,LeadWithHTML5:!0,uiconf_id:e,flashvars:{},params:{wmode:"opaque"},entry_id:b.videoId,readyCallback:function(b){a("#"+b).trigger("kaltura-api-ready")}})})},_kalturaOnAPIReady:function(){var a=this;return a.player.kBind("playerStateChange",function(b){a.events.kaltura.onPlayerStateChange(a,b)}),a}},f.defaults=f.prototype.defaults,a.fn.videoPlayer=function(b){return this.each(function(){var c=a(this).data(e);c||(c=new f(this,b).init(),a(this).data(e,c))})}}(jQuery,window,document)});
//# sourceMappingURL=videoplayer.js.map